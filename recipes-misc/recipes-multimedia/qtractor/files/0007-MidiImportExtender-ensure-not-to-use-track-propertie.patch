From 5702e0b1c514aae433886f8574c0a43de10cde14 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Andreas=20M=C3=BCller?= <schnitzeltony@gmail.com>
Date: Mon, 27 Nov 2017 18:39:07 +0100
Subject: [PATCH 1/2] MidiImportExtender: ensure not to use track properties
 before they are set
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Andreas MÃ¼ller <schnitzeltony@gmail.com>
---
 src/qtractorMidiImportExtender.cpp | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/src/qtractorMidiImportExtender.cpp b/src/qtractorMidiImportExtender.cpp
index ea72b8a..0129d0f 100644
--- a/src/qtractorMidiImportExtender.cpp
+++ b/src/qtractorMidiImportExtender.cpp
@@ -369,7 +369,7 @@ bool qtractorMidiImportExtender::finishTracksForExtension(
 		// import. This indicates from first glance that track is special or
 		// broken or...
 		QString sTrackName;
-		if (pTrack->midiBank() >= 0 && pTrack->midiProg() >= 0) {
+		if (properties.midiBank >= 0 && properties.midiProg >= 0) {
 			// Set track name based upon type set up.
 			switch (m_extendedSettings.eMidiImportTrackNameType) {
 			case Midifile:
@@ -395,12 +395,12 @@ bool qtractorMidiImportExtender::finishTracksForExtension(
 
 					const qtractorMidiManager::Banks& banks
 						= list[sInstrumentName];
-					if (!banks.contains(pTrack->midiBank()))
+					if (!banks.contains(properties.midiBank))
 						break;
 
 					// A patch name was found!
-					const qtractorMidiManager::Progs& progs = banks[pTrack->midiBank()].progs;
-					sTrackName = progs[pTrack->midiProg()];
+					const qtractorMidiManager::Progs& progs = banks[properties.midiBank].progs;
+					sTrackName = progs[properties.midiProg];
 				}
 
 				// Drum track's name is fixed - patch names are not really useful at drums.
-- 
2.9.5

