From a5275b9facecc8a77cb6c47c1c186b8135fa34f3 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Andreas=20M=C3=BCller?= <schnitzeltony@googlemail.com>
Date: Sat, 4 Nov 2017 20:41:50 +0100
Subject: [PATCH 1/4] Add qtractorPluginListDocument to save/load plugin-lists
 to XML
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

For MIDI Import dialog it is necessary to save/load plugin-lists. The easiest
way to do is to reuse the code used when saving/loading sessions. To perform
save/load only on plugin-lists an own document class has to be created.

Signed-off-by: Andreas MÃ¼ller <schnitzeltony@googlemail.com>
---
 src/qtractorPluginListDocument.cpp | 54 ++++++++++++++++++++++++++++++++++++++
 src/qtractorPluginListDocument.h   | 49 ++++++++++++++++++++++++++++++++++
 src/src.pro                        |  2 ++
 3 files changed, 105 insertions(+)
 create mode 100644 src/qtractorPluginListDocument.cpp
 create mode 100644 src/qtractorPluginListDocument.h

diff --git a/src/qtractorPluginListDocument.cpp b/src/qtractorPluginListDocument.cpp
new file mode 100644
index 0000000..4b895ed
--- /dev/null
+++ b/src/qtractorPluginListDocument.cpp
@@ -0,0 +1,54 @@
+// qtractorPluginListDocument.cpp
+//
+/****************************************************************************
+   Copyright (C) 2005-2017, rncbc aka Rui Nuno Capela. All rights reserved.
+
+   This program is free software; you can redistribute it and/or
+   modify it under the terms of the GNU General Public License
+   as published by the Free Software Foundation; either version 2
+   of the License, or (at your option) any later version.
+
+   This program is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+   GNU General Public License for more details.
+
+   You should have received a copy of the GNU General Public License along
+   with this program; if not, write to the Free Software Foundation, Inc.,
+   51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
+
+*****************************************************************************/
+
+#include "qtractorPluginListDocument.h"
+#include "qtractorPlugin.h"
+
+
+// Constructor.
+qtractorPluginListDocument::qtractorPluginListDocument(
+		QDomDocument *pDocument, qtractorPluginList *pPluginList)
+		: qtractorDocument(pDocument, "qtractorPluginList"),
+		m_pPluginList(pPluginList)
+
+{
+
+}
+
+
+// Destructor.
+qtractorPluginListDocument::~qtractorPluginListDocument()
+{
+}
+
+
+bool qtractorPluginListDocument::loadElement(QDomElement *pElement)
+{
+	return m_pPluginList->loadElement(this, pElement);
+}
+
+
+bool qtractorPluginListDocument::saveElement(QDomElement *pElement)
+{
+	return m_pPluginList->saveElement(this, pElement);
+}
+
+// end of qtractorPluginListDocument.cpp
diff --git a/src/qtractorPluginListDocument.h b/src/qtractorPluginListDocument.h
new file mode 100644
index 0000000..57464d7
--- /dev/null
+++ b/src/qtractorPluginListDocument.h
@@ -0,0 +1,49 @@
+// qtractorPluginListDocument.h
+//
+/****************************************************************************
+   Copyright (C) 2005-2017, rncbc aka Rui Nuno Capela. All rights reserved.
+
+   This program is free software; you can redistribute it and/or
+   modify it under the terms of the GNU General Public License
+   as published by the Free Software Foundation; either version 2
+   of the License, or (at your option) any later version.
+
+   This program is distributed in the hope that it will be useful,
+   but WITHOUT ANY WARRANTY; without even the implied warranty of
+   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+   GNU General Public License for more details.
+
+   You should have received a copy of the GNU General Public License along
+   with this program; if not, write to the Free Software Foundation, Inc.,
+   51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
+
+*****************************************************************************/
+
+#ifndef __qtractorPluginListDocument_h
+#define __qtractorPluginListDocument_h
+
+#include "qtractorDocument.h"
+
+// Forward declarations.
+class qtractorPluginList;
+
+class qtractorPluginListDocument : public qtractorDocument
+{
+public:
+
+	// Constructor.
+	qtractorPluginListDocument(QDomDocument *pDocument, qtractorPluginList *pPluginList);
+	// Destructor.
+	~qtractorPluginListDocument();
+
+	// External storage element overrides.
+	virtual bool loadElement (QDomElement *pElement);
+	virtual bool saveElement (QDomElement *pElement);
+
+private:
+	qtractorPluginList *m_pPluginList;
+};
+
+#endif // __qtractorPluginListDocument_h
+
+// end of qtractorPluginListDocument.h
diff --git a/src/src.pro b/src/src.pro
index b4bd0e3..949bded 100644
--- a/src/src.pro
+++ b/src/src.pro
@@ -95,6 +95,7 @@ HEADERS += config.h \
 	qtractorPlugin.h \
 	qtractorPluginFactory.h \
 	qtractorPluginCommand.h \
+	qtractorPluginListDocument.h \
 	qtractorPluginListView.h \
 	qtractorPropertyCommand.h \
 	qtractorRingBuffer.h \
@@ -220,6 +221,7 @@ SOURCES += \
 	qtractorPlugin.cpp \
 	qtractorPluginFactory.cpp \
 	qtractorPluginCommand.cpp \
+	qtractorPluginListDocument.cpp \
 	qtractorPluginListView.cpp \
 	qtractorRubberBand.cpp \
 	qtractorScrollView.cpp \
-- 
2.9.5

